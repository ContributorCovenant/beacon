sudo: required
dist: xenial
language: ruby
branches:
  only:
  - release
rvm:
  - "2.5.3"
script:
  - bundle exec rails db:create RAILS_ENV=test
  - bundle exec rails db:migrate RAILS_ENV=test
  - bundle exec rspec
  - bundle exec rubocop
services:
  - postgresql
addons:
  postgresql: "10"
  apt:
    packages:
    - postgresql-10
    - postgresql-client-10
deploy:
  provider: heroku
  api_key:
    secure: "ce4b318c-57ec-4436-8e12-e3352c9885f8"
  app: coc-beacon
  on: release
  run:
    - "rake db:migrate"
    - restart
